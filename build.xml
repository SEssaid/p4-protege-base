<?xml version = "1.0" encoding = "UTF-8"?>
<project name = "protege" default = "run" basedir = ".">

   <property environment="env"/>
   <property name = "protege.home"      location="${env.PROTEGE_HOME}"/>

   <property file="local.properties"/>
   <property file="version.properties"/>
	
	<target name="add.version">
		<echo append="true"
			  file="${protege.home}/build.properties"
		      message="major.version=${major.version}${line.separator}"/>
		<echo append="true"
			  file="${protege.home}/build.properties"
		      message="minor.version=${minor.version}${line.separator}"/>
		<echo append="true"
			  file="${protege.home}/build.properties"
		      message="micro.version=${micro.version}${line.separator}"/>
		<echo append="true"
			  file="${protege.home}/build.properties"
		      message="build.number=${build.number}${line.separator}"/>
	</target>

    <!-- ===================================================================  -->
    <!-- OSGI Targets -->
    <!-- ===================================================================  -->

    <target name="equinox">
      <delete  dir="${protege.home}"/>
      <mkdir dir="${protege.home}"/>
      <ant antfile="osgi/build-equinox.xml" target="install"/>
      <antcall target="add.version"/>
    </target>

    <target name="run.equinox" depends="equinox">
      <ant antfile="osgi/build-equinox.xml" target="run"/>
    </target>

    <target name="debug.equinox" depends="equinox">
      <ant antfile="osgi/build-equinox.xml" target="debug"/>
    </target>


    <target name="felix">
      <delete  dir="${protege.home}"/>
      <mkdir dir="${protege.home}"/>
      <ant antfile="osgi/build-felix.xml" target="install"/>
      <antcall target="add.version"/>
    </target>

    <target name="run.felix" depends="felix">
      <ant antfile="osgi/build-felix.xml" target="run"/>
    </target>

    <target name="debug.felix" depends="felix">
      <ant antfile="osgi/build-felix.xml" target="debug"/>
    </target>

    <target name="knopflerfish">
      <delete  dir="${protege.home}"/>
      <mkdir dir="${protege.home}"/>
      <ant antfile="osgi/build-knopflerfish.xml" target="install"/>
      <antcall target="add.version"/>
    </target>

    <target name="run.knopflerfish" depends="knopflerfish">
      <ant antfile="osgi/build-knopflerfish.xml" target="run"/>
    </target>

    <target name="debug.knopflerfish" depends="knopflerfish">
      <ant antfile="osgi/build-knopflerfish.xml" target="debug"/>
    </target>

    <target name="osx">
      <delete  dir="${protege.home}"/>
      <mkdir dir="${protege.home}"/>
      <ant antfile="osgi/build-osx.xml" target="install"/>
      <antcall target="add.version"/>
    </target>


    <!-- ===================================================================  -->
    <!-- Defaults -->
    <!-- ===================================================================  -->

    <target name="install" depends="equinox"/>
    <target name="run"     depends="run.equinox"/>
    <target name="debug"   depends="debug.equinox"/>


    <!-- ===================================================================  -->
    <!-- Javadoc - Runs better as a single target -->
    <!-- ===================================================================  -->
    <target name = "javadoc" depends = "equinox">
        <mkdir dir = "${javadoc.dir}"/>
        <javadoc destdir = "${javadoc.dir}" 
                 doctitle = "Protege 4.0 beta"
                 windowtitle = "Protege 4.0 beta" 
                 footer = "Protege 4.0 beta" 
                 header = "Protege 4.0 beta" 
                 author = "true"
                 defaultexcludes = "yes"
                 source = "1.5"
                 linksource = "no"
                 maxmemory = "500M">
            <sourcepath>
                <pathelement path = "plugins/org.coode.dlquery/src"/>
                <pathelement path = "plugins/org.coode.owlviz/src"/>
                <pathelement path = "plugins/org.protege.common/src"/>
                <pathelement path = "plugins/org.protege.editor.core.application/src"/>
                <pathelement path = "plugins/org.protege.editor.owl/src"/>
                <!--pathelement path = "uk.ac.manchester.cs.owl.owlapi.factplusplus"/-->
            </sourcepath>
            <classpath>
                <fileset dir="${equinox.home}">
                    <include name="**/*.jar"/>
                </fileset>
            </classpath>
            <link href = "http://java.sun.com/j2se/1.5.0/docs/api/"/>
            <bottom><![CDATA[<small><a href=mailto:p4-feedback@lists.stanford.edu>Submit a bug report or feature request</a></small>]]></bottom>
        </javadoc>
    </target>


    <!-- ===================================================================  -->
    <!-- USAGE -->
    <!-- ===================================================================  -->

    <target name="usage">
      <echo message = "equinox - build an eclipse based distribution"/>
      <echo message = "run - build the default distribution and run it"/>
      <echo message = "clean - clean all built files except for the manifests"/>
      <echo message = "debug - start up a remote debug (hard core people only)"/>
      <echo message = "felix - build a felix based distribution"/>
      <echo message = "knopflerfish - build a knopflerfish distribution"/>
      <echo message = "osx - build a standalone os x application (based on felix)"/>
    </target>
</project>
