<?xml version = "1.0" encoding = "UTF-8"?>
<project name = "Protege Felix Distribution Build File" default = "run" basedir = ".">
	<property name="src"      location="osgi/src.felix"/>
	<property name="classes"  location="${build}/classes.felix"/>
	<property name="jar"      location="${protege.home}/bin/wrapper.jar"/>
	

	<target name="build.wrapper">
		<delete dir="${build}"/>
		<mkdir dir="${classes}"/>
		<mkdir dir="${protege.home}/bin"/>
		<javac srcdir="${src}" destdir="${classes}" classpath="./osgi/felix/bin/felix.jar"/>
		<jar basedir="${classes}" destfile="${jar}"/>
    </target>

    <!-- ===================================================================  -->
    <!-- FELIX - create a felix-based distribution -->
    <!-- ===================================================================  -->
    <target name = "install" depends="build.wrapper">
        <copy todir = "${protege.home}">
            <fileset dir = "./osgi/felix"/>
            <fileset dir = "." includes = "log4j.xml"/>
        </copy>
        <copy todir = "${protege.home}/bundles" file="./osgi/common/org.eclipse.equinox.common.jar"/>
        <copy todir = "${protege.home}/bundles" file="./osgi/common/org.eclipse.equinox.registry.jar"/>
        <copy todir = "${protege.home}/bundles" file="./osgi/common/org.eclipse.equinox.supplement.jar"/>
        <chmod file = "${protege.home}/run.sh" perm = "u+x"/>
        <chmod file = "${protege.home}/run.command" perm = "u+x"/>
    </target>

    <!-- ===================================================================  -->
    <!-- RUN.FELIX -->
    <!-- ===================================================================  -->
    <target name = "run">
        <java fork = "true" dir = "${protege.home}" 
              classname = "org.apache.felix.main.Main">
            <jvmarg value = "-Dlog4j.configuration=file:log4j.xml"/>
            <jvmarg value = "-Dorg.protege.plugin.dir=plugins"/>
            <jvmarg value = "-Xmx1500M"/>
            <classpath>
              <pathelement path="${protege.home}/bin/felix.jar"/>
            </classpath>
        </java>
    </target>

    <!-- ===================================================================  -->
    <!-- DEBUG.FELIX -->
    <!-- ===================================================================  -->
    <target name = "debug">
        <java fork = "true" dir = "${protege.home}" 
              classname = "org.apache.felix.main.Main">
            <jvmarg value = "-Dlog4j.configuration=file:log4j.xml"/>
            <jvmarg value = "-Dorg.protege.plugin.dir=plugins"/>
            <jvmarg value = "-agentlib:jdwp=transport=dt_socket,address=8500,server=y,suspend=n"/>
            <jvmarg value = "-Xmx1500M"/>
            <classpath>
              <pathelement path="${protege.home}/bin/felix.jar"/>
            </classpath>
        </java>
    </target>

</project>
